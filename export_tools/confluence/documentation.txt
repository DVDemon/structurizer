h1. {anchor:cdf}CDF
Сервис генерации первычных документов за контрагента

h2. {anchor:введение-и-цели}Введение и цели
h3. {anchor:обзор-требований}Обзор требований
Пользователям требуется инструмент, позволяющий автоматизировать создание первичных документов и обеспечить высокий уровень автоматической обработки транзакций

h3. {anchor:пользователи}Пользователи
Владельцы контрактов

h3. {anchor:основные-качественные-характеристики}Основные качественные характеристики
* Общее количество записей ЗП за 3 года - 60 млн.
* Общее количество пользователей - 500
* Средняя требуемая интенсивность генерации документов - 1 документ в секунду

h3. {anchor:стейкхолдеры}Стейкхолдеры
Разработка производится по заказу Операционного блока

h3. {anchor:домен}Домен
Управление документооборотом

h3. {anchor:бизнес-метрики}Бизнес-метрики
|| Метрика || Целевой показатель || Метод расчёта ||
| Доля входящих документов, сформированных на основе подготовленного шаблона | 25% | Общее количество входящих документов / количество подписанных шаблонов |

h3. {anchor:bc-tc}BC TC
|| bc short || bc full || tc short || tc full ||
| Формирование набора первичных документов по расходным договорам Компании за контрагента | Возможность сформировать за контрагента в унифицированном формате набор первичных документов по расходным договорам Компании, согласовать его с контрагентом, для сокращения времени и затрат на обработку при финансовом учете | Включение контракта в обработку | Передача для группы контрактов признака того, что по данным контрактам требуется формировать и отправлять контрагенту первичные документы |
|  |  | Получение текущего статуса генерации документа | Получение информации о текущем статусе обработки контрактов, статусе подписания документа контрагентом, возникших ошибках |
|  |  | Получение статистики по генерации документов | Получение информации о количестве успешно обработанных документов, статистика ошибок при обработке \(за период) |
|  |  | Передача бизнес-правил для управления генерацией документов | Формирование правил, по которым будет выполняться генерация документов \(периодичность, особенности донасыщения данными) |

h3. {anchor:критичность}Критичность
|| Параметр || Оценка ||
| Критичность | 3-Business Operation |
| Класс восстановления | 3 |

h3. {anchor:свойства-приложения-к-проверке}Свойства приложения к проверке
h4. {anchor:проверка-бизнес-метрик}Проверка бизнес-метрик
|| Метрика || Ожидаемые значения ||
| Доля входящих документов, сформированных на основе подготовленного шаблона | В зависимости от этапа |

h4. {anchor:проверка-выполнения-cj-продукта}Проверка выполнения CJ продукта
|| CJ || Способ тестирования ||
|  |  |

h4. {anchor:проверка-интеграционных-взаимодействий}Проверка интеграционных взаимодействий
|| Описание взаимодействия || Способ тестирования ||
| Интеграция с ECM \(шлюз в ЭДО) | Вызов healthcheck ECM |
| Интеграция с DMP | Проверка доступности реплицирующих таблиц |
| Взаимодействие с внешними потребителями через MAPIC | Вызов healthcheck CDF при помощи обращения через MAPIC |
| Интеграция с платформой наблюдаемости | Проверка доступности |

h4. {anchor:проверка-развертывания-стендов}Проверка развертывания стендов
|| Стенд || Узел || Способ тестирования ||
| DEV | Общие узлы | Не проверяется |
| DEV | integration_backend | Не проверяется |
| DEV | metrics_showcase | Не проверяется |
| DEV | status_pipeline | Не проверяется |
| DEV | metrics_streaming | Не проверяется |
| DEV | scheduler | Не проверяется |
| DEV | queue | Не проверяется |
| DEV | integration | Не проверяется |
| DEV | replicating | Не проверяется |
| TEST | integration_backend |  |
| TEST | metrics_showcase |  |
| TEST | status_pipeline |  |
| TEST | metrics_streaming |  |
| TEST | scheduler |  |
| TEST | queue |  |
| TEST | integration |  |
| TEST | replicating |  |
| PROD-LIKE | integration_backend |  |
| PROD-LIKE | metrics_showcase |  |
| PROD-LIKE | status_pipeline |  |
| PROD-LIKE | metrics_streaming |  |
| PROD-LIKE | scheduler |  |
| PROD-LIKE | queue |  |
| PROD-LIKE | integration |  |
| PROD-LIKE | replicating |  |
| PROD | integration_backend |  |
| PROD | metrics_showcase |  |
| PROD | status_pipeline |  |
| PROD | metrics_streaming |  |
| PROD | scheduler |  |
| PROD | queue |  |
| PROD | integration |  |
| PROD | replicating |  |
|  | Аренда техпозиций |  |
| DEV | standart_purchase_order_scope_loader_siterent | Не проверяется |
| DEV | data_miner_siterent | Не проверяется |
| DEV | xml_maker_siterent | Не проверяется |
| DEV | operation_siterent | Не проверяется |
| TEST | standart_purchase_order_scope_loader_siterent |  |
| TEST | data_miner_siterent |  |
| TEST | xml_maker_siterent |  |
| TEST | operation_siterent |  |
| PROD-LIKE | standart_purchase_order_scope_loader_siterent |  |
| PROD-LIKE | data_miner_siterent |  |
| PROD-LIKE | xml_maker_siterent |  |
| PROD-LIKE | operation_siterent |  |
| PROD | standart_purchase_order_scope_loader_siterent |  |
| PROD | data_miner_siterent |  |
| PROD | xml_maker_siterent |  |
| PROD | operation_siterent |  |

h4. {anchor:проверка-настройки-сети}Проверка настройки сети
|| Стенд || Узел || Способ тестирования ||
| DEV | Общие узлы | Не проверяется |
| DEV | integration_backend | Не проверяется |
| DEV | metrics_showcase | Не проверяется |
| DEV | status_pipeline | Не проверяется |
| DEV | metrics_streaming | Не проверяется |
| DEV | scheduler | Не проверяется |
| DEV | queue | Не проверяется |
| DEV | integration | Не проверяется |
| DEV | replicating | Не проверяется |
| TEST | integration_backend |  |
| TEST | metrics_showcase |  |
| TEST | status_pipeline |  |
| TEST | metrics_streaming |  |
| TEST | scheduler |  |
| TEST | queue |  |
| TEST | integration |  |
| TEST | replicating |  |
| PROD-LIKE | integration_backend |  |
| PROD-LIKE | metrics_showcase |  |
| PROD-LIKE | status_pipeline |  |
| PROD-LIKE | metrics_streaming |  |
| PROD-LIKE | scheduler |  |
| PROD-LIKE | queue |  |
| PROD-LIKE | integration |  |
| PROD-LIKE | replicating |  |
| PROD | integration_backend |  |
| PROD | metrics_showcase |  |
| PROD | status_pipeline |  |
| PROD | metrics_streaming |  |
| PROD | scheduler |  |
| PROD | queue |  |
| PROD | integration |  |
| PROD | replicating |  |
|  | Аренда техпозиций |  |
| DEV | standart_purchase_order_scope_loader_siterent | Не проверяется |
| DEV | data_miner_siterent | Не проверяется |
| DEV | xml_maker_siterent | Не проверяется |
| DEV | operation_siterent | Не проверяется |
| TEST | standart_purchase_order_scope_loader_siterent |  |
| TEST | data_miner_siterent |  |
| TEST | xml_maker_siterent |  |
| TEST | operation_siterent |  |
| PROD-LIKE | standart_purchase_order_scope_loader_siterent |  |
| PROD-LIKE | data_miner_siterent |  |
| PROD-LIKE | xml_maker_siterent |  |
| PROD-LIKE | operation_siterent |  |
| PROD | standart_purchase_order_scope_loader_siterent |  |
| PROD | data_miner_siterent |  |
| PROD | xml_maker_siterent |  |
| PROD | operation_siterent |  |

h4. {anchor:проверка-развертывания-по}Проверка развертывания ПО
|| Компонент || Критерии успешного развёртывания || Критерии успешного отката ||
| Общие |  |  |
| integration_backend |  |  |
| metrics_showcase |  |  |
| status_pipeline |  |  |
| metrics_streaming |  |  |
| scheduler |  |  |
| queue |  |  |
| integration |  |  |
| replicating |  |  |
| Аренда техпозиций |  |  |
| standart_purchase_order_scope_loader_siterent |  |  |
| data_miner_siterent |  |  |
| xml_maker_siterent |  |  |
| operation_siterent |  |  |

h4. {anchor:проверка-инженерных-метрик}Проверка инженерных метрик
|| Метрика || Ожидаемые значения ||
|  |  |

h4. {anchor:проверка-производительности}Проверка производительности
|| Метрика || Ожидаемые значения ||
|  |  |

h4. {anchor:проверка-нагрузки}Проверка нагрузки
|| Метрика || Ожидаемые значения ||
|  |  |

h4. {anchor:проверки-качества-данных}Проверки качества данных
|| Сущность || Формат представления || Атрибут || Способ проверки ||
|  |  |  |  |

h2. {anchor:hld}HLD
h3. {anchor:аннотация}Аннотация
Продукт Документы за контрагента включает в себя ряд проектов:

|| Мнемоника || Проект || Описание || Статус ||
| siterent | Аренда техпозиций | Автоматизация создания документов по аренде техпозиций \(MVP) | В разработке |
| enb | Энергобиллинг |  | Анализ |

h3. {anchor:контекстная-диаграмма}Контекстная диаграмма
!SystemContext-001.png!### Контейнерная диаграмма \(общая)

!Container-001.png!

h3. {anchor:контейнерная-диаграмма-аренда-техпозиций}Контейнерная диаграмма \(аренда техпозиций)
!Filtered-001.png!

h3. {anchor:контейнерная-диаграмма-энергобиллинг}Контейнерная диаграмма \(энергобиллинг)
!Filtered-002.png! ### Ролевая модель

|| Роль || Группа пользователей || Права ||
| Владелец контракта | Сотрудники компании | Внесение контарктов в скоуп продукта, получение аналитических данных, создание бизнес-правил для своих контктов |
| Контрагент | Внешние пользователи | Получение документа в ЭДО, подписание документа в ЭДО |

h4. {anchor:uc01-создание-документа}UC01 Создание документа
!Dynamic-001.png! ### Архитектурные ограничения

* Решение должно быть построено на технологиях, определённых технорадаром.
* Решение должно быть реализовано с учётом возможности предоставления коммунального функционала. ### Нефункциональные требования

h4. {anchor:доступность}Доступность
|| Источник воздействия || Событие || Объект || Состояние || Реакция || Измерение реакции ||
| API |  |  |  |  |  |
| Программное обеспечение \(сервер) | Отсутствие ответа, ответ со статусом 500 | Виртуальный сервер | Normal operation | Логировать событие, предотвратить перерастание ошибки в сбой, передать данные в систему логирования | Коэффициент доступности не ниже 95% |
| Программное обеспечение \(сервер) | Некорректный ответ | Артефакты и данные, используемые системой | Normal operation | Логировать событие, логировать контекст события, изолировать влияние некорректного ответа | Система предотвращает не менее 10 неисправностей в секунду |
| Программное обеспечение \(внешняя система) | Некорректный запрос | Артефакты и данные, используемые системой | Normal operation | Изолировать влияние некорректного запроса, логировать источник события, логировать событие | Система предотвращает не менее 50 неисправностей в секунду |
| Программное обеспечение \(внешняя система) | Авария | Программная система | Shutdown | Попытаться логировать событие и отправить результат в Sentry | Система недоступна до перезапуска клиента |
| Программное обеспечение \(сервер) | Авария | Виртуальный сервер | Shutdown | Логировать событие, передать данные в систему логирования, быть временно недоступным на время проведения ремонтных работ | Система недоступна не более 1 часа |
| Core app |  |  |  |  |  |
| Программное обеспечение | Авария | Программная система | Normal operation | Снижение ппроизводительности системы, ввод в работу дополнительных ресурсов | Система снижает производительность не более, чем на 10 процентов |

h4. {anchor:производительность}Производительность
Решение должно предусматривать горизонтальное масштабирование в случае повышения нагрузки.

|| Требование || Комментарий || Способ расчёта ||
| Система должна обеспечивать одновременное хранение в БД не менее 72 млн. записей | Количество документов, потенциально ожидаемых к генерации за период в 3 года | Количество ЗП * 12 \(месяцев) * 3 \(года) |
| Система должна иметь возможность получения данных с интенсивностью не менее 2 млн. записей в сутки | Количество документов, потенциально ожидаемых к генерации в текущем периоде в случае, если генерация всех документов за период ожидается в один день | Количество ЗП |
| Система должна обеспечивать генерацию 24 xml-документов \(5 Kb) в секунду | Интенсивность генерации документов, потенциально ожидаемых к генерации в текущем периоде в случае, если генерация всех документов за период ожидается в один день | Количество ЗП / 86400 \(секунд в сутках) |
| Система должна предусматривать возможность передачи данных через REST API с интенсивностью не менее 50 RPS | Интеграционный API для передачи данных \(флаги обработки и бизнес-правила) из сторонних систем | Экспертная оценка |

|| Источник воздействия || Событие || Объект || Состояние || Реакция || Измерение реакции ||
| API |  |  |  |  |  |
| Запрос внешней системы | Стохастическое событие | Компонент системы | Normal operation | Система возвращает ответ | max latency 200 ms, процент запросов, которые остаются неудовлетворенными - не более 5% |
| Таймер уведомлений | Периодическое событие | Компонент системы | Normal operation | Система потребляет ресурсы | Уровень использования вычислительного ресурса, не более: CPU 10%, RAM 20% |
| Передача данных во внешнюю систему | Периодическое событие | Компонент системы | Normal operation | Система обслуживает более приоритетное событие | Уровень использования вычислительного ресурса, не более: CPU 10%, RAM 20% |
| Core app |  |  |  |  |  |
| Передача данных во внешнюю систему | Периодическое событие | Компонент системы | Normal operation | Система обслуживает более приоритетное событие | Уровень использования вычислительного ресурса, не более: CPU 85%, RAM 85% |
| Получение данных из внешней системы | Периодическое событие | Компонент системы | Normal operation | Система обслуживает более приоритетное событие | Уровень использования вычислительного ресурса, не более: CPU 85%, RAM 85% |

h4. {anchor:надёжность}Надёжность
Система должна быть восстанавливаема после полной потери данных с глубиной восстановленных данных не менее 1 часа. Система должна предусматривать архивное хранение данных на протяжении не менее 5 лет с момента их возникновения.

h4. {anchor:наблюдаемость}Наблюдаемость
Система должна обеспечивать логирование, хранение и обработку записей о пользовательских действиях, системных событиях, ошибках и авариях в течение не менее 3 лет с момента их возникновения.

h3. {anchor:метрики-инженерного-мониторинга}Метрики инженерного мониторинга
|| ##### LAT - задержка Точки монтиторинга: Компонент api ||
| ##### TRF - трафик Точки монтиторинга: Компоненты api, standart_purchase_order_scope_loader_siterent, data_miner_siterent, xml_maker_siterent |
| Инструмент: Prometheus |
| \| Метод расчёта | Целевое значение | Отправка нотификации | Создание инцидента | Роль для назначения ТТ | \|———————————————————\-\|——————|———————\-\|——————–|————————\| | Текущий показатель RPS \(api) | <= 100 | 100 | - | - | | Текущий показатель TPS \(компоненты генерации документов) | <= 25 | 25 | - | - | | Задержка транзакции | 0.04 s | 0.08 s | 0.5 s | IT Инж 1 ур. \| |

h5. {anchor:err---ошибки}ERR - ошибки
Точки монтиторинга: Компоненты api, standart_purchase_order_scope_loader_siterent, data_miner_siterent, xml_maker_siterent

Инструмент:
Вывод логов в ELK

|| Метод расчёта || Целевое значение || Отправка нотификации || Создание инцидента || Роль для назначения ТТ ||
| Логирование ошибок | 0 | 1 | 1 | IT Инж 1 ур. |

|| ##### SAT - насыщенность Точки монтиторинга: Компоненты api, standart_purchase_order_scope_loader_siterent, data_miner_siterent, xml_maker_siterent, queue, operation_siterent, replicating ||
| ##### HLT - статус HealthCheck Точки монтиторинга: Компонент api |
| Инструмент: Zabbix |
| \| Метод расчёта | Целевое значение | Отправка нотификации | Создание инцидента | Роль для назначения ТТ | \|————————————|——————|———————\-\|———————|————————\| | Проверка ответа метода healthcheck | HTTP 200 | HTTP 4xx, HTTP 500 | HTTP 4xx, HTTP 500 | IT Инж 1 ур. \| |

h5. {anchor:avl---доступность}AVL - доступность
Точки монтиторинга: Компонент api

Инструмент:
Zabbix

|| Метод расчёта || Целевое значение || Отправка нотификации || Создание инцидента || Роль для назначения ТТ ||
| Проверка ответа метода HealthCheck | Ответ получен | Ответ отсутствует | Ответ отсутствует | IT Инж 2 ур. |

|| ##### SLI - производительность Точки монтиторинга: Компонент api ||
| ##### UPT - коэфициент доступности Точки монтиторинга: Компоненты api, standart_purchase_order_scope_loader_siterent, data_miner_siterent, xml_maker_siterent, operation_siterent, replicating |
| Инструмент: Prometheus |
| \| Метод расчёта | Целевое значение | Отправка нотификации | Создание инцидента | Роль для назначения ТТ | \|—————————————————————\-\|——————|———————\-\|——————–|————————\| | Процент времени, в течение которого сервис возвращает HTTP 200 | >= 95% | < 95% | < 95% | IT Инж 1 ур. | | Обеспечение годового uptime | 432 h | < 2 | <= 0 | IT Инж 2 ур. \| |

h5. {anchor:dr---коэффициент-недоступности}DR - коэффициент недоступности
Точки монтиторинга: Компоненты api, standart_purchase_order_scope_loader_siterent, data_miner_siterent, xml_maker_siterent, operation_siterent, replicating

Инструмент:
Prometheus

|| Метод расчёта || Целевое значение || Отправка нотификации || Создание инцидента || Роль для назначения ТТ ||
| 100% - UPT | < 5% | > 5% | > 5% | IT Инж 1 ур. |

h3. {anchor:интерфейсные-соглашения}Интерфейсные соглашения
WIP### Логическая модель данных

!classes_siterent.png!

!db.png!

ЗП - заказ на приобретение

h4. {anchor:первичные-документы}Первичные документы
UTD - Универсальный передаточный документ \(первичный документ + счёт-фактура)
UTD2 - Универсальный передаточный документ, тип 2 \(только первичный документ)
Invoice - Счёт-фактура

h4. {anchor:transaction}Transaction
Событие генерации документа по стандартного ЗП и отправки его в ЭДО

h4. {anchor:описание-полей}Описание полей
h5. {anchor:file_id}file_id
Уникальный идентификатор файла XML

h5. {anchor:vers_form}vers_form
Версия программы. Статичное значение "5.01"

h5. {anchor:vers_prog}vers_prog
Версия программы, с помощью которой сформирован файл

h5. {anchor:id_send}id_send
Идентификатор участника документооборота - отправителя файла обмена счета-фактуры \(информации продавца)

h5. {anchor:id_recip}id_recip
Идетификатор участника документооборота - получателя файла обмена счета-фактуры \(информации продаца)

h5. {anchor:name_send}name_send
Наименование отправителя

h5. {anchor:inn_send}inn_send
ИНН отправителя

h5. {anchor:id_edo_send}id_edo_send
Идентификатор оператора электронного документооборота отправителя файла обмена счета-фактуры \(информации продавца)

h5. {anchor:code_knd}code_knd
Код документа по КНД, статичное значение 1115131

h5. {anchor:function}function
Принимает значения СЧФ/СЧФДОП/ДОП, СвРК/СвЗК

h5. {anchor:doc_name}doc_name
Наименование документа по факту хозяйственной жизни

h5. {anchor:doc-initial_name}doc-initial_name
Наименование первичного документа. Не формируется если Функция = СЧФ

h5. {anchor:form_date}form_date
Дата формирования файла обмена счета-фактуры в формате ДД.ММ.ГГГГ

h5. {anchor:form_time}form_time
Время формирования файла обмена счета-фактуры \(информации продавца)

h5. {anchor:subj_complier}subj_complier
Наименование экономического субъекта - составителя файла обмена счета-фактуры

h5. {anchor:sf_num}sf_num
Порядковый номер счета-фактуры

h5. {anchor:sf_date}sf_date
Дата составления \(выписки) счета-фактуры в формате ДД.ММ.ГГГГ

h5. {anchor:currency_code}currency_code
Валюта: Код. Заполняется из ограниченного справочника - классификатора валют. Рубль всегда 643

h5. {anchor:full_vendor_name}full_vendor_name
Полное наименование продавца

h5. {anchor:inn_vendor}inn_vendor
ИНН ЮЛ продавца

h5. {anchor:kpp_vendor}kpp_vendor
КПП ЮЛ продавца

h5. {anchor:vendor_name}vendor_name
ФИО ИП продавца

h5. {anchor:inn_vendor-1}inn_vendor
ИНН ИП продавца

h5. {anchor:index_vendor}index_vendor
Индекс продавца

h5. {anchor:region_code_vendor}region_code_vendor
Код региона продавца

h5. {anchor:city_vendor}city_vendor
Город продавца

h5. {anchor:street_vendor}street_vendor
Улица продавца

h5. {anchor:house_vendor}house_vendor
Дом продавца

h5. {anchor:building_vendor}building_vendor
Корпус продавца

h5. {anchor:full_buyer_name}full_buyer_name
Полное наименование покупателя

h5. {anchor:inn_buyer}inn_buyer
ИНН покупателя

h5. {anchor:kpp_buyer}kpp_buyer
КПП покупателя

h5. {anchor:index-buyer}index-buyer
Индекс покупателя

h5. {anchor:region_code_buyer}region_code_buyer
Код региона покупателя

h5. {anchor:city_buyer}city_buyer
Город покупателя

h5. {anchor:street_buyer}street_buyer
Улица покупателя

h5. {anchor:house_buyer}house_buyer
Дом покупателя

h5. {anchor:building_buyer}building_buyer
Корпус покупателя

h5. {anchor:bank_acc}bank_acc
Номер банковского счета

h5. {anchor:bank_name}bank_name
Наименование банка

h5. {anchor:bank_code}bank_code
Банковский идентификационный код

h5. {anchor:corr_acc}corr_acc
Корреспондентский счет

h5. {anchor:currency_name}currency_name
Валюта: Наименование

h5. {anchor:id_po}id_po
Идентификатор

h5. {anchor:po_num}po_num
Значение. Доп. поле для указания ЗП

h5. {anchor:line_num}line_num
Номер строки таблицы

h5. {anchor:item_description}item_description
Наименование товара \(описание выполненных работ, оказанных услуг), имущественных прав. Обязательно при отстутсвии ХарактерТов, АртикулТов, КодТов

h5. {anchor:sum_without_nds}sum_without_nds
Стоимость товаров \(работ, услуг), имущественных прав без налога - всего

h5. {anchor:tax_name}tax_name
Налоговая ставка

h5. {anchor:unit_meas_lookup_code}unit_meas_lookup_code
Код единицы измерения

h5. {anchor:list_price_per_unit}list_price_per_unit
Цена \(тариф) за единицу измерения

h5. {anchor:quantity}quantity
Количество \(объем)

h5. {anchor:sum_include_nds}sum_include_nds
Стоимость товаров \(работ, услуг), имущественных прав с налогом - всего

h5. {anchor:sum_nds}sum_nds
Значение суммы налога

h5. {anchor:unit_meas_lookup_code-1}unit_meas_lookup_code
Наименование единицы измерения

h5. {anchor:sum_without_nds-1}sum_without_nds
Всего к оплате, Стоимость товаров \(работ, услуг), имущественных прав без налога - всего

h5. {anchor:xml_contract_number}xml_contract_number
Номер документа - основания

h5. {anchor:xml_contract_date}xml_contract_date
Дата документа - основания

h5. {anchor:contract}contract
Наименование документа - основания

h5. {anchor:note_to_vendor}note_to_vendor
Содержание операции

h2. {anchor:lld}LLD
h3. {anchor:описание-технологического-стека}Описание технологического стека
|| Технология || Категория || Статус технологии в технорадаре ||
| C# 10 | Языки программирвоания | ADOPT |
| Kafka | Брокеры сообщений | ADOPT |
| PostgreSQL 14 | СУБД | ADOPT |
| Kubernetes | Инфраструктура | ADOPT |

h3. {anchor:компонентные-диаграммы-общие}Компонентные диаграммы \(общие)
Общие для всех проектов сервисы: * dwh - реплицирующая база данных * cdf-db - основная база данных * integration_backend - бэкенд для входящих интеграций * metrics_showcase, metrics_streaming - сервисы сбора метрик * status_pipeline - сервис проверки статусов подписания * scheduler - оркестратор задач * queue - асинхронная очередь / брокер сообщений * cdf-db.integration_scheme - схема базы данных \(ID СЗП и бизнес-правила) * dwh.nfs_scheme - схема базы данных \(реплика данных с DMP) * cdf-db.hangfire_scheme - схема базы данных \(данные для оркестратора задач) * xml_maker - сервис генерации документов

!Component-001.png! !Component-002.png! !Component-003.png! !Component-004.png! !Component-005.png! !Component-006.png!

h3. {anchor:компонентные-диаграммы-аренда-техпозиций}Компонентные диаграммы \(аренда техпозиций)
!Dynamic-001.png!

Состав проекта siterent: * standart_purchase_order_scope_loader_siterent - контроллер запуска процесса генерации документов * data_miner_siterent - сервис насыщения данными * cdf-db.operation_siterent_scheme - схема базы данных \(транзакции для проекта по аренда техпозиций)

!Component-007.png! !Component-008.png! !Component-009.png! !Component-010.png!

h3. {anchor:компонентные-диаграммы-энергобиллинг}Компонентные диаграммы \(энергобиллинг)
!Dynamic-002.png!

Состав проекта energy_billing: * single_contract_loader - контроллер запуска процесса генерации документов * data_miner_energy_billing - сервис насыщения данными * cdf-db.operation_energy_billing_scheme - схема базы данных \(транзакции для проекта по аренда техпозиций)

!Component-011.png! !Component-012.png! !Component-013.png! !Component-014.png! ### Deployment диаграмма \(аренда техпозиций)

!Deployment-001.png!

h3. {anchor:deployment-диаграмма-аренда-техпозиций}Deployment диаграмма \(аренда техпозиций)
!Deployment-003.png! ### Спецификация API

<>### Сетевая схема

!Deployment-002.png! !Deployment-004.png! !network.png!

h4. {anchor:dev}DEV
|| Узел || На схеме || URL || IP || Порт || Протокол ||
| operation_siterent_scheme, integration_scheme, hangfire_scheme, operation_energy_billing_scheme | cdf-db | cdf-dev-db.database-dev-pg.cloud.vimpelcom.ru | 10.26.30.221 | 5432 | TCP |

h4. {anchor:test}TEST
|| Узел || На схеме || URL || IP || Порт || Протокол ||
| operation_siterent_scheme, integration_scheme, hangfire_scheme, operation_energy_billing_scheme | cdf-db | cdf-test-db.database-test-pg.cloud.vimpelcom.ru | 10.26.30.148 | 5432 | TCP |

h4. {anchor:prodlike}PRODLIKE
|| Узел || На схеме || URL || IP || Порт || Протокол ||
| operation_siterent_scheme, integration_scheme, hangfire_scheme, operation_energy_billing_scheme | cdf-db | cdf-plike-db.prodlike-pg.cloud.vimpelcom.ru | 10.26.28.79 | 5432 | TCP |

h4. {anchor:prod}PROD
|| Узел || На схеме || URL || IP || Порт || Протокол ||
| operation_siterent_scheme, integration_scheme, hangfire_scheme, operation_energy_billing_scheme | cdf-db | cdf-prod-db.database-prod-pg.cloud.vimpelcom.ru | 10.28.49.50 | 5432 | TCP |

h3. {anchor:диаграммы-последовательности}Диаграммы последовательности
h4. {anchor:общий-процесс-аренда-техпозиций}Общий процесс \(аренда техпозиций)
!siterent_flow.png!### DFD

h4. {anchor:общий-поток-данных}Общий поток данных
!dfd.png!### Эксплуатационная документация

h4. {anchor:учётные-записи}Учётные записи
|| Учётная запись || Роль || Владелец ||
| cdf-dev-tech | ТУЗ \(БД) |  |
| cdf-test-tech | ТУЗ \(БД) |  |
| cdf-prodlike-tech | ТУЗ \(БД) |  |
| cdf-prod-tech | ТУЗ \(БД) |  |

h3. {anchor:модель-релизной-политики}Модель релизной политики
h4. {anchor:термины-и-определения}Термины и определения
* UAT - пользовательское тестирование
* Релиз - процесс выпуска новой версии системы, а также результат этого процесса
* Release notes - документ, содержащий перечень изменений, вносимых в систему в ходе релиза

h4. {anchor:общие-сведения}Общие сведения
Документы за контрагента \(CDF)
Сервис генерации шаблонов первичных документов

h4. {anchor:виды-релизов-и-их-периодичность}Виды релизов и их периодичность
* Плановый релиз - 1 раз в месяц
* Hotfix - по мере необходимости \(устранение багов и уязвимостей)

h4. {anchor:правила-обозначения-версий}Правила обозначения версий
Версии обозначаются следующим образом:

XX.YY.ZZ
где XX - тип инфраструктуры \(0 - физический сервер, 1 - виртуальный сервер, 2 - виртуальный сервер со средой контейнеризации, 3 - k8s), YY - сквозной номер версии, ZZ - номер hotfix в контексте версии.

h4. {anchor:порядок-формирования-и-утверждения-релизов}Порядок формирования и утверждения релизов
Релизс остоит из четырех этапов:
- планирование - определение состава релиза и назначение исполнителей - реализация - разработка релиза и поставка версии системы на тестовый стенд - тестирование - проведение UAT \(при необходимости - возврат на этап реализации) - ввод в эксплуатацию - согласование поставки релиза на продуктивную среду

Объёмы и график релиза должны быть утверждены не позднее, чем за 10 дней до его начала. Не допускается внесение изменений в плановый объём релиза. В том случае, если после планирования релиза были выявлены баги или уязвимости, они могут быть устранены в hotfix с пропорциональным смещением даты завершения релиза.

h4. {anchor:порядок-формирования-выпуска-версии}Порядок формирования выпуска версии
* Все задачи должны быть заведены в Jira в виде Story
* По всем Story должна быть проведена оценка трудоёмкости
* Во всех Story должен быть проставлен атрибут "Исправить в версии" с указанием номера ожидаемой версии
* Каждая Story должна включать подзадачи со следующими типами:
** Бизнес-проектирование - подзадача считается выполненной, если к ней прикреплены согласованные владельцем системы БФТ
** Подготовка ТЗ - подзадача считается выполненной, если к ней прикреплено техническое задание на разработку
** Разработка - подзадачи считаются выполненными, когда версия системы передаётся на тестирование
** Тестирование - подзадачи считаются выполненными, когда версия системы успешно проходит все тесты и UAT
** Документирвоание - подзадача считается выполненной после оформления всех необходимых артефактов и согласования RFC о поставке версии на продуктивный стенд
** Установка релиза - подзадача включает в себя перечень шагов по установке релиза, а также план отката

h4. {anchor:порядок-утверждения-версии}Порядок утверждения версии
h4. {anchor:необходимые-компоненты-релизов}Необходимые компоненты релизов
* БФТ и ТЗ
* Код новой версии, размещённый в корпоративном репозитории
* План установки релиза
* План отката релиза
* План sanity-тестирования и отчёт о его результатах
* План UAT и отчёт о его результатах
* Release notes

h4. {anchor:ограничения-на-установку-релизов}Ограничения на установку релизов
Релизы не рекомендуется устанавливать: - В праздницные дни, а также позднее, чем за 5 дней до наступления многодневных праздников - В пятницу - В периоды повышенной нагрузки на систему, вызванной массовыми командировками - В периоды отчётности - В периоды внедрения изменений в смежных системахэ

h4. {anchor:правила-внедрения-срочных-изменений}Правила внедрения срочных изменений
h4. {anchor:специальные-правила-характерыне-для-системы}Специальные правила, характерыне для системы
h4. {anchor:правила-хранения-мастер-копий}Правила хранения мастер-копий
h4. {anchor:ссылки}Ссылки
h4. {anchor:описание-выпуска-версии-системы-шаблон}Описание выпуска версии системы \(шаблон)
Общие сведения о системе: - Краткое наименование системы - Полное наименование системы - Код системы в CMDB - Код версии

Состав выпускаемой документации:

|| Документ || Версия || Описание ||
|  |  |  |
|  |  |  |

Программные компоненты, участвующие в выпуске:

|| Компонент || Версия || Описание ||
|  |  |  |
|  |  |  |

Аппаратные средства, участвующие в выпуске:

|| Оборудование || Версия || Описание ||
|  |  |  |
|  |  |  |

Требования к окружению:

|| Компонент окружения || Требуемая версия || Описание влияния ||
|  |  |  |
|  |  |  |

Требования к версиям смежных систем:

|| Система || Требуемая версия || Описание влияния ||
|  |  |  |
|  |  |  |
